<!DOCTYPE html>
<html>
<head>
<title>Sherlock: Routine at A2E4</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-wide.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-wide.css" />
<link rel="stylesheet" type="text/css" href="../sherlock.css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-75RERFCHBG"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-75RERFCHBG');
</script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="A2BD.html">A2BD</a>
</td>
<td class="up">Up: <a href="../maps/all.html#a2e4">Map</a></td>
<td class="next">
Next: <a href="A35D.html">A35D</a>
</td>
</tr>
</table>
<div class="description">A2E4: Routine at A2E4</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="C996.html">C996</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="a2e4"></span>A2E4</td>
<td class="instruction">LD A,$01</td>
<td class="comment-1" rowspan="2">Write 01 to *<a href="A2AA.html">A2AA</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="a2e6"></span>A2E6</td>
<td class="instruction">LD ($A2AA),A</td>
</tr>
<tr>
<td class="address-1"><span id="a2e9"></span>A2E9</td>
<td class="instruction">PUSH IY</td>
<td class="comment-1" rowspan="5">Stash <span class="register">IY</span>, <span class="register">BC</span>, <span class="register">IX</span>, <span class="register">HL</span> and <span class="register">DE</span> on the stack.</td>
</tr>
<tr>
<td class="address-1"><span id="a2eb"></span>A2EB</td>
<td class="instruction">PUSH BC</td>
</tr>
<tr>
<td class="address-1"><span id="a2ec"></span>A2EC</td>
<td class="instruction">PUSH IX</td>
</tr>
<tr>
<td class="address-1"><span id="a2ee"></span>A2EE</td>
<td class="instruction">PUSH HL</td>
</tr>
<tr>
<td class="address-1"><span id="a2ef"></span>A2EF</td>
<td class="instruction">PUSH DE</td>
</tr>
<tr>
<td class="address-1"><span id="a2f0"></span>A2F0</td>
<td class="instruction">LD A,($A033)</td>
<td class="comment-1" rowspan="2">Write *<a href="A033.html">A033</a> to *<a href="A35D.html">A35D</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="a2f3"></span>A2F3</td>
<td class="instruction">LD ($A35D),A</td>
</tr>
<tr>
<td class="address-1"><span id="a2f6"></span>A2F6</td>
<td class="instruction">LD HL,($A034)</td>
<td class="comment-1" rowspan="2">Write *<a href="A034.html">RoomDisplayParameter</a> to *<a href="A35D.html#a35e">A35E</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="a2f9"></span>A2F9</td>
<td class="instruction">LD ($A35E),HL</td>
</tr>
<tr>
<td class="address-1"><span id="a2fc"></span>A2FC</td>
<td class="instruction">LD A,($A00C)</td>
<td class="comment-1" rowspan="2"><span class="register">B</span>=*<a href="A00C.html">A00C</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="a2ff"></span>A2FF</td>
<td class="instruction">LD B,A</td>
</tr>
<tr>
<td class="address-1"><span id="a300"></span>A300</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Set flags.</td>
</tr>
<tr>
<td class="address-1"><span id="a301"></span>A301</td>
<td class="instruction">LD A,$01</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=01.</td>
</tr>
<tr>
<td class="address-1"><span id="a303"></span>A303</td>
<td class="instruction">JR Z,<a href="A2E4.html#a306">$A306</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="A2E4.html#a306">A306</a> if ?? is equal to <span class="register">A</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="a305"></span>A305</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="2">Write 00 to *<a href="A027.html">A027</a>.</td>
</tr>
<tr>
<td class="address-2"><span id="a306"></span>A306</td>
<td class="instruction">LD ($A027),A</td>
</tr>
<tr>
<td class="address-1"><span id="a309"></span>A309</td>
<td class="instruction">CALL <a href="D078.html">$D078</a></td>
<td class="comment-1" rowspan="1">Call <a href="D078.html">D078</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="a30c"></span>A30C</td>
<td class="instruction">JR NC,<a href="A2E4.html#a31a">$A31A</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="A2E4.html#a31a">A31A</a> if ?? is greater than or equal to <span class="register">A</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="a30e"></span>A30E</td>
<td class="instruction">LD A,B</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=<span class="register">B</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="a30f"></span>A30F</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Set flags.</td>
</tr>
<tr>
<td class="address-1"><span id="a310"></span>A310</td>
<td class="instruction">JR NZ,<a href="A2E4.html#a31a">$A31A</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="A2E4.html#a31a">A31A</a> if ?? is not equal to <span class="register">A</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="a312"></span>A312</td>
<td class="instruction">LD HL,$68D1</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="68D1.html">68D1</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="a315"></span>A315</td>
<td class="instruction">CALL <a href="A59F.html">$A59F</a></td>
<td class="comment-1" rowspan="1">Call <a href="A59F.html">A59F</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="a318"></span>A318</td>
<td class="instruction">JR <a href="A2E4.html#a34e">$A34E</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="A2E4.html#a34e">A34E</a>.</td>
</tr>
<tr>
<td class="address-2"><span id="a31a"></span>A31A</td>
<td class="instruction">LD A,($A35D)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=*<a href="A35D.html">A35D</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="a31d"></span>A31D</td>
<td class="instruction">CALL <a href="A2B1.html">$A2B1</a></td>
<td class="comment-1" rowspan="1">Call <a href="A2B1.html">A2B1</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="a320"></span>A320</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="2"><span class="register">IX</span>=<span class="register">HL</span> (using the stack).</td>
</tr>
<tr>
<td class="address-1"><span id="a321"></span>A321</td>
<td class="instruction">POP IX</td>
</tr>
<tr>
<td class="address-1"><span id="a323"></span>A323</td>
<td class="instruction">CALL <a href="A2BD.html">$A2BD</a></td>
<td class="comment-1" rowspan="1">Call <a href="A2BD.html">A2BD</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="a326"></span>A326</td>
<td class="instruction">LD A,($A01D)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=*<a href="A01D.html">A01D</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="a329"></span>A329</td>
<td class="instruction">AND %00010000</td>
<td class="comment-1" rowspan="1">Keep only bits 4.</td>
</tr>
<tr>
<td class="address-1"><span id="a32b"></span>A32B</td>
<td class="instruction">JR NZ,<a href="A2E4.html#a34e">$A34E</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="A2E4.html#a34e">A34E</a> if ?? is not equal to <span class="register">A</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="a32d"></span>A32D</td>
<td class="instruction">CP B</td>
<td class="comment-1" rowspan="2">Jump to <a href="A2E4.html#a336">A336</a> if <span class="register">A</span> is equal to <span class="register">B</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="a32e"></span>A32E</td>
<td class="instruction">JR Z,<a href="A2E4.html#a336">$A336</a></td>
</tr>
<tr>
<td class="address-1"><span id="a330"></span>A330</td>
<td class="instruction">CALL <a href="DC6C.html">$DC6C</a></td>
<td class="comment-1" rowspan="1">Call <a href="DC6C.html">DC6C</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="a333"></span>A333</td>
<td class="instruction">CALL Z,<a href="A2A2.html">$A2A2</a></td>
<td class="comment-1" rowspan="1">Call <a href="A2A2.html">A2A2</a> if <span class="register">B</span> is equal to 00.</td>
</tr>
<tr>
<td class="address-2"><span id="a336"></span>A336</td>
<td class="instruction">CALL <a href="A720.html#a724">$A724</a></td>
<td class="comment-1" rowspan="1">Call <a href="A720.html#a724">A724</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="a339"></span>A339</td>
<td class="instruction">LD DE,$017F</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=017F.</td>
</tr>
<tr>
<td class="address-1"><span id="a33c"></span>A33C</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="3">Jump to <a href="A2E4.html#a348">A348</a> if <span class="register">B</span> is not equal to 00.</td>
</tr>
<tr>
<td class="address-1"><span id="a33d"></span>A33D</td>
<td class="instruction">CP B</td>
</tr>
<tr>
<td class="address-1"><span id="a33e"></span>A33E</td>
<td class="instruction">JR NZ,<a href="A2E4.html#a348">$A348</a></td>
</tr>
<tr>
<td class="address-1"><span id="a340"></span>A340</td>
<td class="instruction">CALL <a href="A880.html#a887">$A887</a></td>
<td class="comment-1" rowspan="1">Call <a href="A880.html#a887">A887</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="a343"></span>A343</td>
<td class="instruction">CALL <a href="A360.html">$A360</a></td>
<td class="comment-1" rowspan="1">Call <a href="A360.html">A360</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="a346"></span>A346</td>
<td class="instruction">JR <a href="A2E4.html#a34b">$A34B</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="A2E4.html#a34b">A34B</a>.</td>
</tr>
<tr>
<td class="address-2"><span id="a348"></span>A348</td>
<td class="instruction">CALL <a href="A37D.html">$A37D</a></td>
<td class="comment-1" rowspan="1">Call <a href="A37D.html">A37D</a>.</td>
</tr>
<tr>
<td class="address-2"><span id="a34b"></span>A34B</td>
<td class="instruction">CALL <a href="A2A2.html">$A2A2</a></td>
<td class="comment-1" rowspan="1">Call <a href="A2A2.html">A2A2</a>.</td>
</tr>
<tr>
<td class="address-2"><span id="a34e"></span>A34E</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="3">Write 00 to; <ul class="">
<li>*<a href="A2AA.html">A2AA</a></li>
<li>*<a href="A027.html">A027</a></li>
</ul></td>
</tr>
<tr>
<td class="address-1"><span id="a34f"></span>A34F</td>
<td class="instruction">LD ($A2AA),A</td>
</tr>
<tr>
<td class="address-1"><span id="a352"></span>A352</td>
<td class="instruction">LD ($A027),A</td>
</tr>
<tr>
<td class="address-1"><span id="a355"></span>A355</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="5">Restore <span class="register">DE</span>, <span class="register">HL</span>, <span class="register">IX</span>, <span class="register">BC</span> and <span class="register">IY</span> from the stack.</td>
</tr>
<tr>
<td class="address-1"><span id="a356"></span>A356</td>
<td class="instruction">POP HL</td>
</tr>
<tr>
<td class="address-1"><span id="a357"></span>A357</td>
<td class="instruction">POP IX</td>
</tr>
<tr>
<td class="address-1"><span id="a359"></span>A359</td>
<td class="instruction">POP BC</td>
</tr>
<tr>
<td class="address-1"><span id="a35a"></span>A35A</td>
<td class="instruction">POP IY</td>
</tr>
<tr>
<td class="address-1"><span id="a35c"></span>A35C</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="A2BD.html">A2BD</a>
</td>
<td class="up">Up: <a href="../maps/all.html#a2e4">Map</a></td>
<td class="next">
Next: <a href="A35D.html">A35D</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&copy; 1984 Melbourne House &copy; 2025 ArcadeGeek LTD.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 9.6.</div>
<div class="repository">Link to <a rel="noopener nofollow" href="https://github.com/pobtastic/sherlock/">Source code</a>.</div>
<div><a href="../dec/asm/41700.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>
<!DOCTYPE html>
<html>
<head>
<title>After Shock: Routine at AC4D</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-wide.css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-75RERFCHBG"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-75RERFCHBG');
</script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="AC2F.html">AC2F</a>
</td>
<td class="up">Up: <a href="../maps/all.html#ac4d">Map</a></td>
<td class="next">
Next: <a href="AC60.html">AC60</a>
</td>
</tr>
</table>
<div class="description">AC4D: Parser: Validate Any Direct Object</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
In most adventure games, the structure for a command is "verb + direct object". This is usually how the player interacts with the game world. The verb describes the action, and the direct object is what the action is performed on. For example; "TAKE SHOE" uses the verb "TAKE" on the direct object "SHOE".
</div>
</div>
<table class="output">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>
<tr>
<td class="register">A</td>
<td class="register-desc">The number of valid direct objects in the user input tokens</td>
</tr>
<tr>
<td class="register">F</td>
<td class="register-desc">The carry flag is set when the command is malformed</td>
</tr>
<tr>
<td class="register">F</td>
<td class="register-desc">The zero flag is set when there are no valid direct objects present in the input tokens</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="ac4d"></span>
<div class="comments">
<div class="paragraph">
The first token is the verb, so target the second token for the direct object.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Parser_ValidateAnyDirectObject</td>
<td class="address-2"><span id="ac4d"></span>AC4D</td>
<td class="instruction">LD A,($A13C)</td>
<td class="comment-1" rowspan="1">Fetch the <a href="A13B.html#a13c">second token from the user input</a> and store it in <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ac50"></span>AC50</td>
<td class="instruction">CP $FF</td>
<td class="comment-1" rowspan="2">Jump forward to <a href="AC4D.html#ac5c">ValidateAnyDirectObject</a> if the token is anything other than the terminator character (FF).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ac52"></span>AC52</td>
<td class="instruction">JR NZ,<a href="AC4D.html#ac5c">ValidateAnyDirectObject</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="ac54"></span>
<div class="comments">
<div class="paragraph">
The token was the terminator character (FF), so the sentence is malformed.
</div>
<div class="paragraph">
E.g. They tried "TAKE" but didn't write anything after it.
</div>
<div class="paragraph">
Print "Please be more specific.".
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ac54"></span>AC54</td>
<td class="instruction">LD HL,$0017</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="CDC1.html">Messaging_PleaseBeMoreSpecific</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ac57"></span>AC57</td>
<td class="instruction">CALL <a href="A25C.html">PrintCompressedStringAndNewline</a></td>
<td class="comment-1" rowspan="1">Call <a href="A25C.html">PrintCompressedStringAndNewline</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ac5a"></span>AC5A</td>
<td class="instruction">SCF</td>
<td class="comment-1" rowspan="1">Set the carry flag to indicate this call was a failure.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ac5b"></span>AC5B</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="ac5c"></span>
<div class="comments">
<div class="paragraph">
The user input tokens have a direct object, return how many are in the command buffer.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">ValidateAnyDirectObject</td>
<td class="address-2"><span id="ac5c"></span>AC5C</td>
<td class="instruction">CALL <a href="A60A.html">Parser_CountItems</a></td>
<td class="comment-1" rowspan="1">Call <a href="A60A.html">Parser_CountItems</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ac5f"></span>AC5F</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<div class="comments">
<div class="paragraph">
View the equivalent code in; <ul class="">
<li><a href="/adventure-games/jewelsofbabylon/asm/C4B7.html">The Jewels Of Babylon</a></li>
<li><a href="/adventure-games/warlord/asm/AFB7.html">Warlord</a></li>
</ul>
</div>
</div>
</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="AC2F.html">AC2F</a>
</td>
<td class="up">Up: <a href="../maps/all.html#ac4d">Map</a></td>
<td class="next">
Next: <a href="AC60.html">AC60</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&copy; 1986 Interceptor Software UK &copy; 2025 ArcadeGeek LTD.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 9.6.</div>
<div class="repository">Link to <a rel="noopener nofollow" href="https://github.com/pobtastic/adventure-games/tree/main/sources/aftershock/">Source code</a>.</div>
<div><a href="../dec/asm/44109.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>